machine:
  node:
    version: 4.2.6
dependencies:
  cache_directories:
    - "node_modules"
    - "webapp/node_modules"
    - "~/.npm"
    - "~/.meteor"
  override:
    - PATH=$PATH:$HOME/webapp/.meteor
    - if [ -d ~/.meteor ]; then sudo ln -s ~/.meteor/meteor /usr/local/bin/meteor; fi
    - if [ ! -e $HOME/.meteor/meteor ]; then curl https://install.meteor.com | sh; fi
    - meteor update
    - meteor npm install
test:
  override:
    #- meteor npm run functional-ci
    - meteor:
        background: true
    - npm run unit-ci
    - CODECLIMATE_REPO_TOKEN=7c1d7d921e1a66b1208abd0f671d09e172780bd562938090168759c93b802169 meteor npm run codeclimate-test-reporter < .coverage/lcov.info 
    #- until curl --max-time 300 http://localhost:3000/; do sleep 1; done
    #- meteor npm run acceptance-ci
#deployment:
  #production:
    #branch: "devel"
    #commands:
    #  - echo $PROD_SETTINGS > settings-production.json
     # - echo $DEPLOYMENT_TOKEN > deployment_token.json
    #  - METEOR_SESSION_FILE=deployment_token.json DEPLOY_HOSTNAME=eu-west-1.galaxy-deploy.meteor.com meteor deploy --settings settings-production.json customer-management.eu.meteorapp.com